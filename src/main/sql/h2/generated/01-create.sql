--
-- (c) Copyright 2005-2011 JAXIO, www.jaxio.com
-- Source code generated by Celerio, a Jaxio product
-- Want to use Celerio within your company? email us at info@jaxio.com
-- Follow us on twitter: @springfuse
-- Template pack-backend:src/main/sql/h2/01-create.p.vm.sql
--
DROP ALL objects;

CREATE TABLE authorities (
	username VARCHAR(50) not null
	,authority VARCHAR(50) not null
);
CREATE UNIQUE INDEX IF NOT EXISTS authorities_idx_1
	ON authorities (username,authority);

CREATE TABLE program (
	id INTEGER(10) not null
	,program_structure_id INTEGER(10)
	,start_date DATE
	,status VARCHAR(25)
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON program (id);
CREATE INDEX IF NOT EXISTS program_structure_id
	ON program (program_structure_id);
ALTER TABLE program ALTER COLUMN id IDENTITY;

CREATE TABLE program_structure (
	id INTEGER(10) not null
	,name VARCHAR(50) not null
	,days INTEGER(10) not null
	,description VARCHAR(200) not null
	,prerequisites INTEGER(10)
	,category VARCHAR(200) not null
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON program_structure (id);
ALTER TABLE program_structure ALTER COLUMN id IDENTITY;

CREATE TABLE user_enrollment (
	id INTEGER(10) not null
	,user_id INTEGER(10)
	,program_id INTEGER(10)
	,result VARCHAR(50)
);
CREATE INDEX IF NOT EXISTS user_enrollment_ibfk_2
	ON user_enrollment (user_id);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON user_enrollment (id);
CREATE INDEX IF NOT EXISTS program_id
	ON user_enrollment (program_id);
CREATE INDEX IF NOT EXISTS user_enrollment_fk2
	ON user_enrollment (user_id);
ALTER TABLE user_enrollment ALTER COLUMN id IDENTITY;

CREATE TABLE user_graduation (
	id INTEGER(10) not null
	,program_structure_id INTEGER(10) not null
	,graduation_date DATE not null
	,title VARCHAR(150) not null
	,user_id INTEGER(10) not null
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON user_graduation (id);
CREATE INDEX IF NOT EXISTS user_graduation_ibfk_2
	ON user_graduation (user_id);
CREATE INDEX IF NOT EXISTS user_graduation_ibfk_1
	ON user_graduation (program_structure_id);
ALTER TABLE user_graduation ALTER COLUMN id IDENTITY;

CREATE TABLE user_profile (
	id INTEGER(10) not null
	,city VARCHAR(80)
	,country VARCHAR(80)
	,title VARCHAR(150)
	,first_name VARCHAR(45)
	,last_name VARCHAR(45)
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON user_profile (id);
ALTER TABLE user_profile ALTER COLUMN id IDENTITY;

CREATE TABLE users (
	username VARCHAR(50) not null
	,password VARCHAR(50) not null
	,enabled BIT not null
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY
	ON users (username);
CREATE PRIMARY KEY 
	ON users (username);


ALTER TABLE authorities 
	ADD CONSTRAINT AUTHORITIES_IBFK_1
		FOREIGN KEY (username)
			REFERENCES users (username);
ALTER TABLE program 
	ADD CONSTRAINT PROGRAM_IBFK_1
		FOREIGN KEY (program_structure_id)
			REFERENCES Program_Structure (id);
ALTER TABLE user_enrollment 
	ADD CONSTRAINT USER_ENROLLMENT_IBFK_2
		FOREIGN KEY (user_id)
			REFERENCES user_profile (id);
ALTER TABLE user_enrollment 
	ADD CONSTRAINT USER_ENROLLMENT_IBFK_1
		FOREIGN KEY (program_id)
			REFERENCES Program (id);
ALTER TABLE user_graduation 
	ADD CONSTRAINT USER_GRADUATION_IBFK_2
		FOREIGN KEY (user_id)
			REFERENCES user_profile (id);
ALTER TABLE user_graduation 
	ADD CONSTRAINT USER_GRADUATION_IBFK_1
		FOREIGN KEY (program_structure_id)
			REFERENCES Program_Structure (id);
